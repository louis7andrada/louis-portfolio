{{ define "main" }}

{{ partial "jsonld/artwork.html" . }}

<section class="px-4 md:px-10 py-16 w-full relative">

  <!-- RESPONSIVE BACK BUTTON (never overlaps title) -->
  <a 
    href="/artworks/" 
    class="
      arrow-btn text-lg absolute 
      left-4 top-10
      sm:left-6 sm:top-8
      md:left-10 md:top-8
      lg:left-10 lg:top-8
      z-40
    "
  >
    ‚Üê Back to Artworks
  </a>

  <!-- TITLE -->
  <h1 class="text-3xl font-semibold mb-10 text-center">
    {{ .Title }}
  </h1>

  <!-- MAIN LAYOUT -->
  <div class="flex flex-col lg:flex-row items-start lg:justify-center gap-10 md:gap-16 max-w-[1400px] mx-auto">

    <!-- IMAGE -->
    <div>
      {{ if .Params.image }}
        <div class="single-image-box">
          <a href="{{ .Params.image }}" target="_blank">
            <img 
              src="{{ .Params.image }}" 
              alt="{{ .Title }}" 
              class="single-image cursor-pointer" 
            />
          </a>
        </div>
      {{ else }}
        <div class="w-[800px] h-[500px] bg-gray-200 flex items-center justify-center text-gray-500">
          No image yet
        </div>
      {{ end }}
    </div>

    <!-- DETAILS -->
    <div class="w-full max-w-[420px] text-lg space-y-5 single-details">
      {{ with .Params.year }}<p><strong>Year:</strong> {{ . }}</p>{{ end }}
      {{ with .Params.size }}<p><strong>Size:</strong> {{ . }}</p>{{ end }}
      {{ with .Params.medium }}<p><strong>Medium:</strong> {{ . }}</p>{{ end }}
      {{ with .Params.availability }}<p><strong>Availability:</strong> {{ . }}</p>{{ end }}
      {{ with .Params.comment }}<p><strong>Comments:</strong> {{ . }}</p>{{ end }}
      {{ with .Params.price }}<p><strong>Price: $</strong> {{ . }}</p>{{ end }}

      {{ if eq .Params.availability "Available" }}
        <a 
          href="/buy/?add={{ .Params.id }}" 
          class="inline-block mt-6 px-6 py-3 bg-[#2c2c2c] text-white rounded text-lg font-semibold hover:bg-[#494949] transition"
        >
          Purchase Artwork
        </a>
      {{ end }}
    </div>

  </div>

  <!-- DESCRIPTION -->
  {{ with .Content }}
    <div class="mt-10 md:mt-16 max-w-[1000px] mx-auto">
      {{ . }}
    </div>
  {{ end }}

  <!-- =============================== -->
  <!-- FILTERED LIST + WORKNUM DESC -->
  <!-- =============================== -->

  {{/* Start with all artworks */}}
  {{ $raw := where .Site.RegularPages "Section" "artworks" }}

  {{/* Build clean filtered list */}}
  {{ $clean := slice }}

  {{ range $raw }}

    {{/* Skip in-progress */}}
    {{ if eq .Params.image "/images/artworks/inprogress.jpeg" }}
      {{ continue }}
    {{ end }}

    {{/* Skip .number IDs */}}
    {{ if findRE "\\.[0-9]+$" .Params.id }}
      {{ continue }}
    {{ end }}

    {{/* Skip the collection page */}}
    {{ if eq .File.BaseFileName "collection-the_tree_the_snake_the_fruit" }}
      {{ continue }}
    {{ end }}

    {{ $clean = $clean | append . }}

  {{ end }}

  {{/* SORTING: ONLY BY worknum DESC */}}
  {{ $sorted := sort $clean "Params.worknum" "desc" }}

  <!-- FIND CURRENT INDEX -->
  {{ $currentIndex := -1 }}
  {{ range $i, $p := $sorted }}
    {{ if eq $p.RelPermalink $.RelPermalink }}
      {{ $currentIndex = $i }}
    {{ end }}
  {{ end }}

  <!-- SAFE PREV/NEXT -->
  {{ $prev := cond (gt $currentIndex 0) (index $sorted (sub $currentIndex 1)) nil }}
  {{ $next := cond (lt $currentIndex (sub (len $sorted) 1)) (index $sorted (add $currentIndex 1)) nil }}

  <!-- ARROWS -->
  {{ with $prev }}
    <a href="{{ .RelPermalink }}" id="prevBtnDesktop"
       class="arrow-btn fixed left-10 top-1/2 -translate-y-1/2">
      &lt Previous
    </a>
  {{ end }}

  {{ with $next }}
    <a href="{{ .RelPermalink }}" id="nextBtnDesktop"
       class="arrow-btn fixed right-10 top-1/2 -translate-y-1/2">
      Next &gt
    </a>
  {{ end }}

</section>

{{ end }}
